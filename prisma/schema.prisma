generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id                  String         @id @default(uuid())
    email               String         @unique
    password            String
    needsPasswordChange Boolean?       @default(false)
    role                UserRole       @default(user)
    createdAt           DateTime       @default(now())
    updatedAt           DateTime       @default(now()) @updatedAt
    profile             Profile?
    quizzes             Quiz[]         @relation("QuizTaker")
    scores              Score[]
}

model Profile {
    id           String    @id @default(uuid())
    userId       String    @unique
    user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    username     String?   @unique
    firstName    String?
    lastName     String?
    dateOfBirth  DateTime?
    phoneNumber  String?
    address      String?
    bio          String?
    profileImage String?
    createdAt    DateTime  @default(now())
    updatedAt    DateTime  @default(now()) @updatedAt
}

model Quiz {
    id          Int        @id @default(autoincrement())
    title       String
    category    String     // e.g., frontend, fullstack, react.js, javascript
    questions   Question[]
    creator     User       @relation("QuizCreator", fields: [creatorId], references: [id])
    creatorId   String
    scores      Score[]
}

model Question {
    id         Int      @id @default(autoincrement())
    content    String
    options    Answer[]
    correctOptionId Int
    quiz       Quiz     @relation(fields: [quizId], references: [id])
    quizId     Int
}

model Answer {
    id        Int      @id @default(autoincrement())
    content   String
    question  Question @relation(fields: [questionId], references: [id])
    questionId Int
}

model Score {
    id        Int      @id @default(autoincrement())
    score     Int
    user      User     @relation("QuizTaker", fields: [userId], references: [id])
    userId    String
    quiz      Quiz     @relation(fields: [quizId], references: [id])
    quizId    Int
}

enum UserRole {
    user
    admin
    superAdmin
}
